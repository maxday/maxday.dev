<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Let&rsquo;s say we want to test that a function is correctly outputting something.
Our function may looks like this simple example: print n times the name given in parameter.
fn greeting(nb: i32, name: &amp;str) { for _ in 0..nb { println!(&#34;hi {}&#34;, name); } } How to test it? ðŸ¤” It looks hard.
One easy way is to refactor our code using a Trait. You can see Traits as interfaces."><title>How to test println!</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.851225d8fa38226bab6e7d88356ad22d4feda354106364f25b97a6ab5a046d56c4fcc55ec60683b17f7aace257421d25b81dfe4c6fcc695afe934b370b480fb8.css integrity="sha512-hRIl2Po4Imurbn2INWrSLU/to1QQY2TyW5emq1oEbVbE/MVexgaDsX96rOJXQh0luB3+TG/MaVr+k0s3C0gPuA=="><script defer data-domain=maxday.dev src=https://plausible.io/js/script.js></script><meta name=description content="Software Engineer, Serverless and Rust addict"><meta property="og:url" content="https://maxday.dev"><meta property="og:type" content="website"><meta property="og:title" content="Maxime David | maxday"><meta property="og:description" content="Software Engineer, Serverless and Rust addict"><meta property="og:image" content="https://maxday.dev/og.jpeg"><meta name=twitter:card content="summary_large_image"><meta property="twitter:domain" content="maxday.dev"><meta property="twitter:url" content="https://maxday.dev"><meta name=twitter:title content="Maxime David | maxday"><meta name=twitter:description content="Software Engineer, Serverless and Rust addict"><meta name=twitter:image content="https://maxday.dev/og.jpeg"><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”¥</text></svg>"></head><body a=light><main class=page-content aria-label=Content><div class=w><a href=/>..</a><article><p class=post-meta><time datetime="2022-11-22 00:00:00 +0800 +0800">2022-11</time></p><h1>How to test println!</h1><p>Let&rsquo;s say we want to test that a function is correctly outputting something.</p><p>Our function may looks like this simple example: print n times the name given in parameter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greeting</span>(nb: <span style=color:#66d9ef>i32</span>, name: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>nb {
</span></span><span style=display:flex><span>        println!(<span style=color:#e6db74>&#34;hi </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, name);
</span></span><span style=display:flex><span>    }   
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>How to test it? ðŸ¤” It looks hard.</p><p>One easy way is to refactor our code using a <code>Trait</code>.
You can see Traits as interfaces.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>trait</span> Logger {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>log</span>(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self, value: String);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, let&rsquo;s define a <code>struct</code> which implements this <code>trait</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>ConsoleLogger</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Logger <span style=color:#66d9ef>for</span> ConsoleLogger {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>log</span>(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self, value: String) {
</span></span><span style=display:flex><span>        println!(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, value);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Great! Now we can refactor our <code>greeting</code> function to use this <code>trait</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greeting</span>(nb: <span style=color:#66d9ef>i32</span>, name: <span style=color:#66d9ef>&amp;</span><span style=color:#66d9ef>str</span>, logger: <span style=color:#66d9ef>&amp;</span><span style=color:#a6e22e>mut</span> <span style=color:#66d9ef>dyn</span> Logger) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> _ <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0</span><span style=color:#f92672>..</span>nb {
</span></span><span style=display:flex><span>        logger.log(format!(<span style=color:#e6db74>&#34;hi </span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>, name));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Ok but how this is helpful for testing?</p><p>Well, now, in tests, we could define a new struct with a different implementation for our trait.</p><p>Here, instead of outputting our strings using <code>println!</code> we will store those in a <code>Vec&lt;String></code>
This way, it will be super easy to assert that our values are valid.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>TestLogger</span>(Vec<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>impl</span> Logger <span style=color:#66d9ef>for</span> TestLogger {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>log</span>(<span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> self, value: String) {
</span></span><span style=display:flex><span>            self.<span style=color:#ae81ff>0.</span>push(value);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And we can finally test:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rust data-lang=rust><span style=display:flex><span><span style=color:#75715e>#[test]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fn</span> <span style=color:#a6e22e>greeting_test</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#66d9ef>mut</span> test_logger <span style=color:#f92672>=</span> TestLogger::default();
</span></span><span style=display:flex><span>    greeting(<span style=color:#ae81ff>2</span>, <span style=color:#e6db74>&#34;maxday&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#66d9ef>mut</span> test_logger);
</span></span><span style=display:flex><span>    assert_eq!(<span style=color:#ae81ff>2</span>, test_logger.<span style=color:#ae81ff>0.</span>len());
</span></span><span style=display:flex><span>    assert_eq!(<span style=color:#e6db74>&#34;hi maxday&#34;</span>, test_logger.<span style=color:#ae81ff>0</span>[<span style=color:#ae81ff>0</span>]);
</span></span><span style=display:flex><span>    assert_eq!(<span style=color:#e6db74>&#34;hi maxday&#34;</span>, test_logger.<span style=color:#ae81ff>0</span>[<span style=color:#ae81ff>1</span>]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Voila! ðŸŽ‰</p><p>Full code here: <a href=https://gist.github.com/maxday/ae3c9f219c35c228dadd5359def5a833>https://gist.github.com/maxday/ae3c9f219c35c228dadd5359def5a833</a></p><p>ðŸš€ ðŸš€ ðŸš€ If you want more Rust, feel free to check my new YouTube channel here: <a href=https://youtube.com/@maxday_coding>https://youtube.com/@maxday_coding</a></p></article></div></main></body></html>